node counter (inc : int; restart : bool)
returns (i : int)
let
  i = if restart then 0 else (pre i + inc);
tel

node avgvelocity (delta : int; sec : bool)
returns (v : int)
let
  v = merge sec ((counter (delta, false) when sec) / 
                 (counter (1 when sec, false when sec)))
                ((pre v) whenot sec);
tel